function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}function isOwn$(o,p){return{}.hasOwnProperty.call(o,p)}function extends$(child,parent){function ctor(){this.constructor=child}for(var key in parent)isOwn$(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child}void function(){for(var el,selector,cache$=["personalize_wizard","personalize_wizard_call_to_action"],i$=0,length$=cache$.length;length$>i$;++i$)selector=cache$[i$],(el=document.getElementById(selector))&&document.body.insertBefore(el,document.body.firstChild);$(function(){return $("#personalize_wizard_call_to_action").show()})}.call(this),null!=window.Groupon?window.Groupon:window.Groupon={},null!=Groupon.Modules?Groupon.Modules:Groupon.Modules={},null!=Groupon.Modules.PersonalizeWizard?Groupon.Modules.PersonalizeWizard:Groupon.Modules.PersonalizeWizard={},null!=Groupon.Modules.PersonalizeWizard.Models?Groupon.Modules.PersonalizeWizard.Models:Groupon.Modules.PersonalizeWizard.Models={},null!=Groupon.Modules.PersonalizeWizard.Views?Groupon.Modules.PersonalizeWizard.Views:Groupon.Modules.PersonalizeWizard.Views={},Groupon.Modules.PersonalizeWizard.Models.BaseStep=function(super$){function BaseStep(){var instance$;instance$=this,this.handleErrorResponse=function(){return BaseStep.prototype.handleErrorResponse.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(BaseStep,super$),BaseStep.prototype.initialize=function(){return this.TRANSLATION_KEY_BASE="js.modules.personalize_wizard."+this.get("name")+"_step"},BaseStep.prototype.validate=function(){},BaseStep.prototype.isValid=function(){return!this.validate(this.attributes)},BaseStep.prototype.handleErrorResponse=function(model,response){var errors;return errors=this._parseErrorResponse(response),this.trigger("error",errors)},BaseStep.prototype.handleNotDone=function(){return this.trigger("error",[this._notDoneYetText()])},BaseStep.prototype._parseErrorResponse=function(response){var message,parsed,responseText;return!response||_.isArray(response)?response:(responseText=response.responseText,responseText?"<"===_.first(responseText)?[$(response.responseText).text()]:"{"===_.first(responseText)?(parsed=$.parseJSON(responseText),(message=null!=parsed&&null!=parsed.error?parsed.error.message:void 0)?[message]:[parsed]):[responseText]:null)},BaseStep.prototype._notDoneYetText=function(){return I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.not_done_yet")},BaseStep}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.Consumer=function(super$){function Consumer(){super$.apply(this,arguments)}return extends$(Consumer,super$),Consumer.prototype.urlRoot="/__apiproxy__/v2/consumers",Consumer.prototype.url=function(){var superUrl;return superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"?client_id="+this.options.clientId},Consumer.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Consumer}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.GenderStep=function(super$){function GenderStep(){super$.apply(this,arguments)}return extends$(GenderStep,super$),GenderStep.prototype.defaults={name:"gender",viewName:"GenderStep"},GenderStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Models.BaseStep,superClass.prototype.initialize.apply(this,arguments),this._setupConsumer()},GenderStep.prototype._setupConsumer=function(){var attributes;return attributes={id:this.get("consumerId"),_csrf:this.get("_csrf")},this.set({consumer:new Groupon.Modules.PersonalizeWizard.Models.Consumer(attributes,{clientId:this.get("clientId")})},{silent:!0})},GenderStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Models.Place=function(super$){function Place(){super$.apply(this,arguments)}var DEFAULT_LOCATION_TYPE;return extends$(Place,super$),Place.prototype.TRANSLATION_KEY_BASE="js.modules.personalize_wizard.place",DEFAULT_LOCATION_TYPE="home",Place.prototype.defaults={name:DEFAULT_LOCATION_TYPE},Place.prototype.urlRoot="/__apiproxy__/v2/consumers",Place.prototype.url=function(){var clientId,consumerId,superUrl;return consumerId=this.get("consumerId"),clientId=this.options.clientId,superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"/"+consumerId+"/places?client_id="+clientId},Place.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Place.prototype.isNew=function(){return!0},Place.prototype.validate=function(attributes){return _.keys(attributes).length>0&&!((null!=attributes.location_string?attributes.location_string.length:void 0)>0)?[I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.required")]:void 0},Place}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Models.PlacesStep=function(super$){function PlacesStep(){super$.apply(this,arguments)}return extends$(PlacesStep,super$),PlacesStep.prototype.defaults={name:"places",viewName:"PlacesStep"},PlacesStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Models.BaseStep,superClass.prototype.initialize.apply(this,arguments),this._setupPlace(),this.get("place").bind("invalid",this.handleErrorResponse,this)},PlacesStep.prototype.validate=function(attributes){var place;return place=attributes.place,null==place?[I18n.translate(""+this.TRANSLATION_KEY_BASE+".errors.required")]:place.validate(place.attributes)},PlacesStep.prototype._setupPlace=function(){var attributes;return attributes={consumerId:this.get("consumerId"),_csrf:this.get("_csrf")},this.set({place:new Groupon.Modules.PersonalizeWizard.Models.Place(attributes,{clientId:this.get("clientId")})},{silent:!0})},PlacesStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Models.InterestsStep=function(super$){function InterestsStep(){super$.apply(this,arguments)}return extends$(InterestsStep,super$),InterestsStep.prototype.defaults={name:"interests",viewName:"InterestsStep"},InterestsStep}(Groupon.Modules.PersonalizeWizard.Models.BaseStep),Groupon.Modules.PersonalizeWizard.Views.BaseStep=function(super$){function BaseStep(){super$.apply(this,arguments)}return extends$(BaseStep,super$),BaseStep.prototype.tagName="section",BaseStep.prototype.className="personalize_step",BaseStep.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this.wizardModel=this.options.wizardModel},BaseStep.prototype.render=function(){return this.$el.show()},BaseStep.prototype.hide=function(){return this.$el.hide()},BaseStep.prototype.nextStep=function(){return this.wizardModel.incrementStep()},BaseStep}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.GenderStep=function(super$){function GenderStep(){var instance$;instance$=this,this._handleError=function(){return GenderStep.prototype._handleError.apply(instance$,arguments)},this._handleSuccess=function(){return GenderStep.prototype._handleSuccess.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(GenderStep,super$),GenderStep.prototype.el="#gender_step",GenderStep.prototype.events={"click .male":"_setMaleGenderPreference","click .female":"_setFemaleGenderPreference"},GenderStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),this.consumer=this.model.get("consumer")},GenderStep.prototype._setMaleGenderPreference=function(){return this._saveGender("male"),this.$(".male").addClass("active"),this.$(".female").removeClass("active")},GenderStep.prototype._setFemaleGenderPreference=function(){return this._saveGender("female"),this.$(".female").addClass("active"),this.$(".male").removeClass("active")},GenderStep.prototype._saveGender=function(gender){return this.consumer.save({deal_preference_gender:gender},{success:this._handleSuccess,error:this._handleError})},GenderStep.prototype._handleSuccess=function(){return this.nextStep()},GenderStep.prototype._handleError=function(){},GenderStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep);var Hogan={};!function(Hogan,useArrayBuffer){function coerceToString(val){return String(null===val||void 0===val?"":val)}function hoganEscape(str){return str=coerceToString(str),hChars.test(str)?str.replace(rAmp,"&amp;").replace(rLt,"&lt;").replace(rGt,"&gt;").replace(rApos,"&#39;").replace(rQuot,"&quot;"):str}Hogan.Template=function(renderFunc,text,compiler,options){this.r=renderFunc||this.r,this.c=compiler,this.options=options,this.text=text||"",this.buf=useArrayBuffer?[]:""},Hogan.Template.prototype={r:function(){return""},v:hoganEscape,t:coerceToString,render:function(context,partials,indent){return this.ri([context],partials||{},indent)},ri:function(context,partials,indent){return this.r(context,partials,indent)},rp:function(name,context,partials,indent){var partial=partials[name];return partial?(this.c&&"string"==typeof partial&&(partial=this.c.compile(partial,this.options)),partial.ri(context,partials,indent)):""},rs:function(context,partials,section){var tail=context[context.length-1];if(!isArray(tail))return section(context,partials,this),void 0;for(var i=0;i<tail.length;i++)context.push(tail[i]),section(context,partials,this),context.pop()},s:function(val,ctx,partials,inverted,start,end,tags){var pass;return isArray(val)&&0===val.length?!1:("function"==typeof val&&(val=this.ls(val,ctx,partials,inverted,start,end,tags)),pass=""===val||!!val,!inverted&&pass&&ctx&&ctx.push("object"==typeof val?val:ctx[ctx.length-1]),pass)},d:function(key,ctx,partials,returnFound){var names=key.split("."),val=this.f(names[0],ctx,partials,returnFound),cx=null;if("."===key&&isArray(ctx[ctx.length-2]))return ctx[ctx.length-1];for(var i=1;i<names.length;i++)val&&"object"==typeof val&&names[i]in val?(cx=val,val=val[names[i]]):val="";return returnFound&&!val?!1:(returnFound||"function"!=typeof val||(ctx.push(cx),val=this.lv(val,ctx,partials),ctx.pop()),val)},f:function(key,ctx,partials,returnFound){for(var val=!1,v=null,found=!1,i=ctx.length-1;i>=0;i--)if(v=ctx[i],v&&"object"==typeof v&&key in v){val=v[key],found=!0;break}return found?(returnFound||"function"!=typeof val||(val=this.lv(val,ctx,partials)),val):returnFound?!1:""},ho:function(val,cx,partials,text,tags){var compiler=this.c,options=this.options;options.delimiters=tags;var text=val.call(cx,text);return text=null==text?String(text):text.toString(),this.b(compiler.compile(text,options).render(cx,partials)),!1},b:useArrayBuffer?function(s){this.buf.push(s)}:function(s){this.buf+=s},fl:useArrayBuffer?function(){var r=this.buf.join("");return this.buf=[],r}:function(){var r=this.buf;return this.buf="",r},ls:function(val,ctx,partials,inverted,start,end,tags){var cx=ctx[ctx.length-1],t=null;if(!inverted&&this.c&&val.length>0)return this.ho(val,cx,partials,this.text.substring(start,end),tags);if(t=val.call(cx),"function"==typeof t){if(inverted)return!0;if(this.c)return this.ho(t,cx,partials,this.text.substring(start,end),tags)}return t},lv:function(val,ctx,partials){var cx=ctx[ctx.length-1],result=val.call(cx);return"function"==typeof result&&(result=coerceToString(result.call(cx)),this.c&&~result.indexOf("{{"))?this.c.compile(result,this.options).render(cx,partials):coerceToString(result)}};var rAmp=/&/g,rLt=/</g,rGt=/>/g,rApos=/\'/g,rQuot=/\"/g,hChars=/[&<>\"\']/,isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}}("undefined"!=typeof exports?exports:Hogan),function(Hogan){function cleanTripleStache(token){"}"===token.n.substr(token.n.length-1)&&(token.n=token.n.substring(0,token.n.length-1))}function trim(s){return s.trim?s.trim():s.replace(/^\s*|\s*$/g,"")}function tagChange(tag,text,index){if(text.charAt(index)!=tag.charAt(0))return!1;for(var i=1,l=tag.length;l>i;i++)if(text.charAt(index+i)!=tag.charAt(i))return!1;return!0}function buildTree(tokens,kind,stack,customTags){for(var instructions=[],opener=null,token=null;tokens.length>0;)if(token=tokens.shift(),"#"==token.tag||"^"==token.tag||isOpener(token,customTags))stack.push(token),token.nodes=buildTree(tokens,token.tag,stack,customTags),instructions.push(token);else{if("/"==token.tag){if(0===stack.length)throw new Error("Closing tag without opener: /"+token.n);if(opener=stack.pop(),token.n!=opener.n&&!isCloser(token.n,opener.n,customTags))throw new Error("Nesting error: "+opener.n+" vs. "+token.n);return opener.end=token.i,instructions}instructions.push(token)}if(stack.length>0)throw new Error("missing closing tag: "+stack.pop().n);return instructions}function isOpener(token,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].o==token.n)return token.tag="#",!0}function isCloser(close,open,tags){for(var i=0,l=tags.length;l>i;i++)if(tags[i].c==close&&tags[i].o==open)return!0}function esc(s){return s.replace(rSlash,"\\\\").replace(rQuot,'\\"').replace(rNewline,"\\n").replace(rCr,"\\r")}function chooseMethod(s){return~s.indexOf(".")?"d":"f"}function walk(tree){for(var code="",i=0,l=tree.length;l>i;i++){var tag=tree[i].tag;"#"==tag?code+=section(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n),tree[i].i,tree[i].end,tree[i].otag+" "+tree[i].ctag):"^"==tag?code+=invertedSection(tree[i].nodes,tree[i].n,chooseMethod(tree[i].n)):"<"==tag||">"==tag?code+=partial(tree[i]):"{"==tag||"&"==tag?code+=tripleStache(tree[i].n,chooseMethod(tree[i].n)):"\n"==tag?code+=text('"\\n"'+(tree.length-1==i?"":" + i")):"_v"==tag?code+=variable(tree[i].n,chooseMethod(tree[i].n)):void 0===tag&&(code+=text('"'+esc(tree[i])+'"'))}return code}function section(nodes,id,method,start,end,tags){return"if(_.s(_."+method+'("'+esc(id)+'",c,p,1),'+"c,p,0,"+start+","+end+',"'+tags+'")){'+"_.rs(c,p,"+"function(c,p,_){"+walk(nodes)+"});c.pop();}"}function invertedSection(nodes,id,method){return"if(!_.s(_."+method+'("'+esc(id)+'",c,p,1),c,p,1,0,0,"")){'+walk(nodes)+"};"}function partial(tok){return'_.b(_.rp("'+esc(tok.n)+'",c,p,"'+(tok.indent||"")+'"));'}function tripleStache(id,method){return"_.b(_.t(_."+method+'("'+esc(id)+'",c,p,0)));'}function variable(id,method){return"_.b(_.v(_."+method+'("'+esc(id)+'",c,p,0)));'}function text(id){return"_.b("+id+");"}var rIsWhitespace=/\S/,rQuot=/\"/g,rNewline=/\n/g,rCr=/\r/g,rSlash=/\\/g,tagTypes={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};Hogan.scan=function(text,delimiters){function addBuf(){buf.length>0&&(tokens.push(new String(buf)),buf="")}function lineIsWhitespace(){for(var isAllWhitespace=!0,j=lineStart;j<tokens.length;j++)if(isAllWhitespace=tokens[j].tag&&tagTypes[tokens[j].tag]<tagTypes._v||!tokens[j].tag&&null===tokens[j].match(rIsWhitespace),!isAllWhitespace)return!1;return isAllWhitespace}function filterLine(haveSeenTag,noNewLine){if(addBuf(),haveSeenTag&&lineIsWhitespace())for(var next,j=lineStart;j<tokens.length;j++)tokens[j].tag||((next=tokens[j+1])&&">"==next.tag&&(next.indent=tokens[j].toString()),tokens.splice(j,1));else noNewLine||tokens.push({tag:"\n"});seenTag=!1,lineStart=tokens.length}function changeDelimiters(text,index){var close="="+ctag,closeIndex=text.indexOf(close,index),delimiters=trim(text.substring(text.indexOf("=",index)+1,closeIndex)).split(" ");return otag=delimiters[0],ctag=delimiters[1],closeIndex+close.length-1}var len=text.length,IN_TEXT=0,IN_TAG_TYPE=1,IN_TAG=2,state=IN_TEXT,tagType=null,tag=null,buf="",tokens=[],seenTag=!1,i=0,lineStart=0,otag="{{",ctag="}}";for(delimiters&&(delimiters=delimiters.split(" "),otag=delimiters[0],ctag=delimiters[1]),i=0;len>i;i++)state==IN_TEXT?tagChange(otag,text,i)?(--i,addBuf(),state=IN_TAG_TYPE):"\n"==text.charAt(i)?filterLine(seenTag):buf+=text.charAt(i):state==IN_TAG_TYPE?(i+=otag.length-1,tag=tagTypes[text.charAt(i+1)],tagType=tag?text.charAt(i+1):"_v","="==tagType?(i=changeDelimiters(text,i),state=IN_TEXT):(tag&&i++,state=IN_TAG),seenTag=i):tagChange(ctag,text,i)?(tokens.push({tag:tagType,n:trim(buf),otag:otag,ctag:ctag,i:"/"==tagType?seenTag-ctag.length:i+otag.length}),buf="",i+=ctag.length-1,state=IN_TEXT,"{"==tagType&&("}}"==ctag?i++:cleanTripleStache(tokens[tokens.length-1]))):buf+=text.charAt(i);return filterLine(seenTag,!0),tokens},Hogan.generate=function(tree,text,options){var code='var _=this;_.b(i=i||"");'+walk(tree)+"return _.fl();";return options.asString?"function(c,p,i){"+code+";}":new Hogan.Template(new Function("c","p","i",code),text,Hogan,options)},Hogan.parse=function(tokens,text,options){return options=options||{},buildTree(tokens,"",[],options.sectionTags||[])},Hogan.cache={},Hogan.compile=function(text,options){options=options||{};var key=text+"||"+!!options.asString,t=this.cache[key];return t?t:(t=this.generate(this.parse(this.scan(text,options.delimiters),text,options),text,options),this.cache[key]=t)}}("undefined"!=typeof exports?exports:Hogan),Groupon.Modules.PersonalizeWizard.Views.PlacesStep=function(super$){function PlacesStep(){var instance$;instance$=this,this._saveError=function(){return PlacesStep.prototype._saveError.apply(instance$,arguments)},this._saveSuccess=function(){return PlacesStep.prototype._saveSuccess.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(PlacesStep,super$),PlacesStep.prototype.el="#places_step",PlacesStep.prototype.partials={errorList:'<ul class="errors">\n  {{#errors}}\n  <li>{{message}}</li>\n  {{/errors}}\n</ul>'},PlacesStep.prototype.events={"click .next_step":"_continueClick",'keypress input[name="location_string"]':"_continueOnEnter"},PlacesStep.prototype.loadingClass="loading",PlacesStep.prototype.doubleClickPreventerClass="prevent_double_click",PlacesStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),this.model.bind("error",this._renderErrors,this)},PlacesStep.prototype._continueOnEnter=function(e){return 13===(e.which||e.keyCode)?(e.preventDefault(),this.$(".next_step").click()):void 0},PlacesStep.prototype._continueClick=function(){return this._submitEnabled()?(this._disableSubmit(),this._savePlace()):!1},PlacesStep.prototype._savePlace=function(){var input,trimmedVal;return this.$(".place_input").addClass(this.loadingClass),input=this.$(".place_input input[name=location_string]"),this._clearInputPlaceholder(input),trimmedVal=$.trim(input.val()),this.model.get("place").save({location_string:trimmedVal},{success:this._saveSuccess,error:this._saveError,dataType:"text"})},PlacesStep.prototype._saveSuccess=function(){return this.$(".place_input").removeClass(this.loadingClass),this._enableSubmit(),this.nextStep()},PlacesStep.prototype._saveError=function(model,response){return this.model.handleErrorResponse(model,response)},PlacesStep.prototype._renderErrors=function(errors){var errorAttributes,template;return this.$(".place_input").removeClass(this.loadingClass),this._enableSubmit(),errorAttributes=_(errors).map(function(e){return{message:e}}),template=Hogan.compile(this.partials.errorList),this.$(".errors").replaceWith(template.render({errors:errorAttributes}))},PlacesStep.prototype._clearInputPlaceholder=function(input){return input.val()===input.attr("placeholder")?(input.val(""),input.removeClass("prompting")):void 0},PlacesStep.prototype._disableSubmit=function(){return this.$(".next_step").addClass(this.doubleClickPreventerClass)},PlacesStep.prototype._enableSubmit=function(){return this.$(".next_step").removeClass(this.doubleClickPreventerClass)},PlacesStep.prototype._submitEnabled=function(){return this.$(".next_step").hasClass(this.doubleClickPreventerClass)?void 0:!0},PlacesStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep),null!=this.Groupon?this.Groupon:this.Groupon={},null!=this.Groupon.Modules?this.Groupon.Modules:this.Groupon.Modules={},null!=this.Groupon.Modules.P13n?this.Groupon.Modules.P13n:this.Groupon.Modules.P13n={},this.Groupon.Modules.P13n.InterestPreferences={updatePreferenceCookie:function(id,value){var cookie,cookieJson,ONE_HOUR_IN_SECONDS,PREFERENCE_COOKIE,updatedPreferences;return ONE_HOUR_IN_SECONDS=3600,PREFERENCE_COOKIE="myprofile_interest_preferences","neutral"===value&&(value="negative"),cookie=Cookie.get(PREFERENCE_COOKIE),cookieJson=JSON.parse(decodeURIComponent(null!=cookie?cookie:"[]")),updatedPreferences=_(cookieJson).reject(function(pref){return pref.id===id}),updatedPreferences.push({id:id,value:value}),Cookie.set(PREFERENCE_COOKIE,encodeURIComponent(JSON.stringify(updatedPreferences)),ONE_HOUR_IN_SECONDS)}},Groupon.Modules.PersonalizeWizard.Models.Interest=function(super$){function Interest(){var instance$;instance$=this,this.toJSON=function(){return Interest.prototype.toJSON.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Interest,super$),Interest.prototype.defaults={value:"neutral"},Interest.prototype.urlRoot="/__apiproxy__/v2/consumers",Interest.prototype.url=function(){var clientId,consumerId,superUrl;return consumerId=this.options.consumerId,clientId=this.options.clientId,superUrl=Backbone.Model.prototype.url.apply(this,arguments),""+superUrl+"/"+consumerId+"/feedback?client_id="+clientId},Interest.prototype.initialize=function(attributes,param$){null==param$&&(param$={}),this.options=param$},Interest.prototype.toggleValue=function(){switch(this.get("value")){case"positive":return this.set({value:"neutral"});case"neutral":return this.set({value:"positive"})}},Interest.prototype.toJSON=function(){return{deal_types:[{id:this.id,value:this.get("value")}],_csrf:this.get("_csrf")}},Interest.prototype.isNew=function(){return!0},Interest.prototype.savePreferenceCookie=function(){return Groupon.Modules.P13n.InterestPreferences.updatePreferenceCookie(this.get("id"),this.get("value"))},Interest}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Views.Interest=function(super$){function Interest(){var instance$;instance$=this,this._updateSelectedClass=function(){return Interest.prototype._updateSelectedClass.apply(instance$,arguments)},this._toggleInterest=function(){return Interest.prototype._toggleInterest.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Interest,super$),Interest.prototype.events={click:"_toggleInterest"},Interest.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this._setupInterest(),this.model.on("change",this._updateSelectedClass)},Interest.prototype._toggleInterest=function(){return this.model.toggleValue(),this.model.save(),this.model.savePreferenceCookie()},Interest.prototype._setupInterest=function(){var attributes,options;return attributes={id:this.$el.data("modelId"),value:this.$el.hasClass("selected")?"positive":"neutral",_csrf:this.options._csrf},options=_(this.options).pick("consumerId","clientId"),this.model=new Groupon.Modules.PersonalizeWizard.Models.Interest(attributes,options)},Interest.prototype._updateSelectedClass=function(){switch(this.model.get("value")){case"neutral":return this.$el.removeClass("selected");case"positive":return this.$el.addClass("selected")}},Interest}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.InterestsStep=function(super$){function InterestsStep(){var instance$;instance$=this,this._continueClick=function(){return InterestsStep.prototype._continueClick.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(InterestsStep,super$),InterestsStep.prototype.el="#interests_step",InterestsStep.prototype.events={"click .next_step":"_continueClick"},InterestsStep.prototype.initialize=function(){var superClass;return superClass=Groupon.Modules.PersonalizeWizard.Views.BaseStep,superClass.prototype.initialize.apply(this,arguments),function(accum$){for(var interestEl,cache$=this.$(".p13n-interest"),i$=0,length$=cache$.length;length$>i$;++i$)interestEl=cache$[i$],accum$.push(new Groupon.Modules.PersonalizeWizard.Views.Interest({el:interestEl,consumerId:this.model.get("consumerId"),clientId:this.model.get("clientId"),_csrf:this.model.get("_csrf")}));return accum$}.call(this,[])},InterestsStep.prototype._continueClick=function(){return this.nextStep()},InterestsStep}(Groupon.Modules.PersonalizeWizard.Views.BaseStep),Groupon.Modules.PersonalizeWizard.Models.Modal=function(super$){function Modal(){super$.apply(this,arguments)}return extends$(Modal,super$),Modal.prototype.defaults={index:0},Modal.prototype.initialize=function(){return this.set({steps:this._setUpSteps()})},Modal.prototype.incrementStep=function(){return this.set({index:this.get("index")+1})},Modal.prototype.getPreviousStep=function(){return this._getStepAtIndex(this.get("index")-1)},Modal.prototype.getCurrentStep=function(){return this._getStepAtIndex(this.get("index"))},Modal.prototype.resetIndex=function(){return this.set({index:0},{silent:!0})},Modal.prototype._getStepAtIndex=function(index){return this.get("steps")[index]},Modal.prototype._stepModels=function(){var options;return options={_csrf:this.get("csrfToken"),clientId:this.get("clientId"),consumerId:this.get("consumerId")},[new Groupon.Modules.PersonalizeWizard.Models.GenderStep(options),new Groupon.Modules.PersonalizeWizard.Models.PlacesStep(options),new Groupon.Modules.PersonalizeWizard.Models.InterestsStep(options)]},Modal.prototype._setUpSteps=function(){return _.map(this._stepModels(),function(this$){return function(model){return new(Groupon.Modules.PersonalizeWizard.Views[model.get("viewName")])({model:model,id:model.get("name")+"_step",wizardModel:this$})}}(this))},Modal}(Backbone.Model),Groupon.Modules.PersonalizeWizard.Views.Modal=function(super$){function Modal(){var instance$;instance$=this,this._getValueFromDOM=function(){return Modal.prototype._getValueFromDOM.apply(instance$,arguments)},this._calculateHorizontalClippingPoint=function(){return Modal.prototype._calculateHorizontalClippingPoint.apply(instance$,arguments)},this._clip=function(){return Modal.prototype._clip.apply(instance$,arguments)},this._updateProgress=function(){return Modal.prototype._updateProgress.apply(instance$,arguments)},this._resize=function(){return Modal.prototype._resize.apply(instance$,arguments)},this._marginBeneathModal=function(){return Modal.prototype._marginBeneathModal.apply(instance$,arguments)},this._close=function(){return Modal.prototype._close.apply(instance$,arguments)},this._open=function(){return Modal.prototype._open.apply(instance$,arguments)},this.finish=function(){return Modal.prototype.finish.apply(instance$,arguments)},this.onIndexChange=function(){return Modal.prototype.onIndexChange.apply(instance$,arguments)},super$.apply(this,arguments)}return extends$(Modal,super$),Modal.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this.$modal=this.$(".modal-content"),this.model.bind("change:index",this.onIndexChange)
},Modal.prototype.show=function(){return this._open(),this._updateProgress(),this.model.getCurrentStep().render(),this._resize(),this._shouldSkipStep(this.model.get("index"))?this._skipStep():void 0},Modal.prototype.onIndexChange=function(model,index){return this._hidePreviousStep(),this._isFinished()?this.finish():this._shouldSkipStep(index)?this._skipStep():this._showStep()},Modal.prototype.finish=function(){return this.model.resetIndex(),this._close()},Modal.prototype._hidePreviousStep=function(){return this.model.getPreviousStep().hide()},Modal.prototype._isFinished=function(){return!this.model.getCurrentStep()},Modal.prototype._shouldSkipStep=function(index){return this._onLocationStep(index)&&this._hasProvidedLocation()?!0:this._onGenderStep(index)&&this._hasProvidedDealPreferenceGender()?!0:!1},Modal.prototype._skipStep=function(){return this.model.incrementStep()},Modal.prototype._showStep=function(){return this.model.getCurrentStep().render(),this._resize(),this._updateProgress()},Modal.prototype._open=function(){return GIG.Modal.open({el:this.$el})},Modal.prototype._close=function(){return GIG.Modal.close()},Modal.prototype._marginBeneathModal=function(){var modalHeight,topMargin;return topMargin=parseInt(this.$modal.css("top"),10),modalHeight=this.$modal.outerHeight(),$(window).height()-modalHeight-topMargin},Modal.prototype._resize=function(){var $scrollable,currentMargin,minimumMargin,newHeight;return $scrollable=this.$(".scrollable:visible"),minimumMargin=50,currentMargin=this._marginBeneathModal(),currentMargin>minimumMargin?$scrollable.height("auto"):(newHeight=$scrollable.height()-(minimumMargin-currentMargin),$scrollable.height(newHeight))},Modal.prototype._updateProgress=function(){return this._clip(this.model.get("index")),this.$("#progress_indicator .step").each(function(this$){return function(index,step){var currentIndex;return currentIndex=this$.model.get("index"),this$._shouldSkipStep(index)?$(step).addClass("completed_step"):currentIndex>index?$(step).addClass("viewed completed_step"):index===currentIndex?$(step).addClass("viewed"):$(step).removeClass("viewed completed_step")}}(this))},Modal.prototype._clip=function(stepIndex){var $progressBar,clipOptions;return $progressBar=this.$("#progress_indicator .complete"),clipOptions="rect(0px "+this._calculateHorizontalClippingPoint(stepIndex)+"px 40px 0px)",$progressBar.css({clip:clipOptions})},Modal.prototype._calculateHorizontalClippingPoint=function(stepIndex){var $step,$stepNumber;return $stepNumber=this.$("#progress_indicator .complete .step_number"),$step=this.$("#progress_indicator .stepped_progress_bar .step"),$stepNumber.width()+$step.width()*stepIndex},Modal.prototype._onGenderStep=function(stepIndex){return 0===stepIndex},Modal.prototype._onLocationStep=function(stepIndex){return 1===stepIndex},Modal.prototype._hasProvidedDealPreferenceGender=function(){return"true"===this._getValueFromDOM("input[name='has_provided_deal_preference_gender']")},Modal.prototype._hasProvidedLocation=function(){return"true"===this._getValueFromDOM("input[name='has_provided_location']")},Modal.prototype._getValueFromDOM=function(selector){return this.$(selector).val()},Modal}(Backbone.View),Groupon.Modules.PersonalizeWizard.Views.CallToAction=function(super$){function CallToAction(){var instance$;instance$=this,this._getValueFromDOM=function(){return CallToAction.prototype._getValueFromDOM.apply(instance$,arguments)},this._csrf=function(){return CallToAction.prototype._csrf.apply(instance$,arguments)},this._clientId=function(){return CallToAction.prototype._clientId.apply(instance$,arguments)},this._consumerId=function(){return CallToAction.prototype._consumerId.apply(instance$,arguments)},this._wizard=function(){return CallToAction.prototype._wizard.apply(instance$,arguments)},super$.apply(this,arguments)}var _WIZARD_SELECTOR,NINETY_DAYS;return extends$(CallToAction,super$),NINETY_DAYS=7776e3,CallToAction.prototype.events={"click .close":"_close","click .open_wizard":"_openWizard"},CallToAction.prototype.initialize=function(){return null!=this.$el?this.$el:this.$el=$(this.el),this._showPersonalizeWizardOnLoad()?this._openWizard():void 0},_WIZARD_SELECTOR="#personalize_wizard",CallToAction.prototype._close=function(e){return e.preventDefault(),this.$el.slideUp("fast"),Cookie.set("personalize_wizard_cta_dismissed",!0,NINETY_DAYS)},CallToAction.prototype._openWizard=function(e){return this._canShowWizard()?(null!=e&&e.preventDefault(),this._wizard().show()):void 0},CallToAction.prototype._wizard=function(){var clientId,consumerId,csrfToken;return clientId=this._clientId(),consumerId=this._consumerId(),csrfToken=this._csrf(),null!=this.wizard?this.wizard:this.wizard=new Groupon.Modules.PersonalizeWizard.Views.Modal({el:_WIZARD_SELECTOR,model:new Groupon.Modules.PersonalizeWizard.Models.Modal({clientId:clientId,consumerId:consumerId,csrfToken:csrfToken})})},CallToAction.prototype._canShowWizard=function(){return $(_WIZARD_SELECTOR).length>0},CallToAction.prototype._showPersonalizeWizardOnLoad=function(){return"true"===this._getValueFromDOM("input[name='auto_pop_wizard']")},CallToAction.prototype._consumerId=function(){return this._getValueFromDOM("input[name='consumer_id']")},CallToAction.prototype._clientId=function(){return this._getValueFromDOM("input[name='client_id']")},CallToAction.prototype._csrf=function(){return this._getValueFromDOM("input[name='_csrf']")},CallToAction.prototype._getValueFromDOM=function(selector){return this.$(selector).val()},CallToAction}(Backbone.View),$(function(){return new Groupon.Modules.PersonalizeWizard.Views.CallToAction({el:"#personalize_wizard_call_to_action"})}),$(window).load(function(){return Groupon.Performance.pageReady()}),$(document).ready(function(){return $("body").removeClass("no-js")});